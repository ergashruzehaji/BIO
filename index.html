<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ergash Ruzehaji - Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --panel-alpha: 0.85; /* adjust panel opacity for readability */
            --overlay-dark: rgba(0,0,0,0.28);
        }

        /* High-contrast overrides when body has .high-contrast */
        body.high-contrast {
            --panel-alpha: 1;
            --overlay-dark: rgba(0,0,0,0.36);
        }

        /* Full-viewport background using Future.jpg */
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            font-family: 'Poppins', sans-serif;
            font-size: 16px; /* larger base font for easier reading */
            line-height: 1.6;
            color: #222;
            background: url('./Future.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        /* High-contrast toggle - fixed control in the top-right */
        .contrast-toggle {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 9999;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            backdrop-filter: blur(6px);
        }

        .contrast-toggle[aria-pressed="true"] {
            background: #fff;
            color: #111;
            box-shadow: 0 4px 14px rgba(0,0,0,0.2);
        }

        /* Options button variant (left side) */
        #optionsToggle { left: 16px; right: auto; }


        /* Subtle fullscreen overlay to improve contrast over the background image */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: var(--overlay-dark);
            pointer-events: none;
            z-index: 0;
        }

        /* Three-column layout: left nav (moved to right visually) + content + right bullets column (removed) */
        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 18px;
            box-sizing: border-box;
            min-height: 100vh;
            display: grid;
            grid-template-columns: 220px 1fr;
            grid-template-rows: auto 1fr auto; /* header, main content, footer/contact */
            gap: 12px;
            position: relative;
            z-index: 1; /* ensure content sits above the body overlay */
        }

        /* Reusable translucent panel to place on top of the background image */
        .panel {
            background: rgba(255,255,255,var(--panel-alpha));
            border-radius: 12px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.2);
            padding: 24px;
            backdrop-filter: blur(4px);
        }

        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            grid-column: 1 / -1;
            grid-row: 1;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 3px solid rgba(255,255,255,0.6);
        }

        h1 { margin: 0; }

        /* Left vertical nav column on desktop */
        .left-nav {
            position: sticky;
            top: 24px;
            height: calc(100vh - 48px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            border-radius: 12px;
            overflow-y: auto;
            align-items: stretch;
            background: rgba(255,255,255,calc(var(--panel-alpha) - 0.02));
            grid-row: 2; /* nav sits in the middle row */
            grid-column: 1;
        }
        .left-nav button {
            text-align: left;
            background: transparent;
            color: #111; /* make left nav labels black and readable */
            border: none;
            padding: 12px 14px; /* larger hit target for children */
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05rem;
            transition: background 0.18s, color 0.18s;
            width: 100%;
        }
        .left-nav button.active {
            background: #fff;
            color: #2c3e50;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0,0,0,0.18);
        }

        /* Top tabs: visible, sticky, high-contrast */
        .top-tabs.panel {
            grid-column: 1 / -1;
            position: sticky;
            top: 12px;
            z-index: 999;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        .top-tabs button {
            background: #2c3e50;
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .top-tabs button.active { background: #3498db; color: #fff; }

        /* Content column uses panels per section and is scrollable with visible sections */
    .content-area { display: block; grid-column: 2; grid-row: 2; }
        /* Center the main content between left nav and right bullets */
        .content-inner {
            max-width: 720px;
            margin: 0 auto;
            position: relative;
            min-height: calc(100vh - 200px);
            display: flex;
            align-items: flex-start; /* place content near the top */
            justify-content: center; /* horizontal center */
            padding: 12px 12px 24px 12px;
        }
    /* Make each tab content flow in document order inside the right column.
       Only the active tab is visible; others are hidden via display. */
    .tab-content {
        position: relative;
        display: none;
        padding: 10px 12px;
        box-sizing: border-box;
        opacity: 0;
        transform: translateY(4px);
        visibility: hidden;
        pointer-events: none;
        transition: opacity 240ms ease, transform 240ms ease, visibility 0s linear 240ms;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        min-height: 160px; /* less vertical space so content sits higher */
    }
    .tab-content.active {
        display: flex;
        opacity: 1;
        transform: none;
        visibility: visible;
        pointer-events: auto;
        transition-delay: 0s;
    }
    .tab-content > .section { width: 100%; max-width: 640px; margin: 0 auto; }
    .section-body { margin: 0; padding-top: 8px; }

    /* Ensure main page areas sit in the right-hand grid column */
    .header, .content-area, .contact-info { grid-column: 2; }

        /* Highlights panel styling (embedded, centered) */
        .highlights {
            margin-top: 18px;
            max-width: 640px;
            margin-left: auto;
            margin-right: auto;
            padding: 12px 16px;
            background: rgba(255,255,255,calc(var(--panel-alpha) - 0.02));
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            text-align: left;
        }
        .highlights h3 { margin: 0 0 8px 0; font-size: 1rem; color: #2c3e50; }
        .highlights ul { margin: 0; padding-left: 20px; }
        .highlights li { margin-bottom: 6px; }

        /* Section collapse styling */
        .section-head { display:flex; align-items:center; justify-content:space-between; gap:12px; }
        .section-toggle {
            background: transparent;
            border: 1px solid rgba(0,0,0,0.08);
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            backdrop-filter: blur(4px);
        }
        .section.collapsed .section-body { display: none; }

        /* Skip link visibility and focus styles */
        .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
        .skip-link:focus, .skip-link:active { position: static; left: auto; width: auto; height: auto; padding: 8px 12px; background: #fff; color: #111; z-index: 10000; border-radius: 6px; text-decoration: none; }

        /* Focus-visible outlines for keyboard users */
        :focus { outline: none; }
        :focus-visible, button:focus-visible, a:focus-visible { outline: 3px solid #3498db; outline-offset: 3px; }

    /* visually-hidden helper for screen-reader-only content */
    .visually-hidden { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; }

        .section { margin-bottom: 24px; }
        .section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 16px;
        }

    .contact-info { text-align: center; }
        .contact-info a { color: #3498db; text-decoration: none; margin: 0 8px; }

        ul { padding-left: 20px; }

        @media (max-width: 900px) {
            .page-container { display: block; padding: 20px 12px; }
            /* Keep the nav vertical (stacked) on small screens as well */
            .left-nav { position: relative; top: 0; height: auto; flex-direction: column; overflow: visible; display:flex; width:100%; }
            .left-nav button { white-space: normal; padding: 14px 16px; font-size: 1.05rem; width:100%; text-align:left; }
            .bullets-toggle { display: inline-block; }
            .section-grid { grid-template-columns: 1fr; }
            /* On smaller screens - no right-side column */
            /* Hide floating show highlights button on small screens (removed) */
            /* Panels revert to normal flow on small screens (no overlay) */
            .content-inner { min-height: auto; position: static; }
            .tab-content { position: relative; visibility: visible; opacity: 1; transform: none; pointer-events: auto; transition: none; display: block; }
        }

        /* Scroll snap support when enabled via body.scroll-snap */
        body.scroll-snap .page-container { scroll-behavior: smooth; scroll-snap-type: y mandatory; }
        body.scroll-snap .tab-content { scroll-snap-align: center; }

        /* Section animations when body has .animations */
        .tab-content .section { opacity: 1; transform: none; transition: opacity 360ms ease, transform 360ms ease; }
        body.animations .tab-content .section { opacity: 0; transform: translateY(10px); }
        body.animations .tab-content.revealed .section { opacity: 1; transform: none; }

    /* Pin-highlights removed */
        @media (max-width: 600px) {
            .profile-photo { width: 80px; height: 80px; }
        }
    </style>
</head>
<body class="high-contrast">
    <!-- Options floating control -->
    <button type="button" id="optionsToggle" class="contrast-toggle" aria-pressed="false" style="left:16px; right:auto;">Options</button>
    <div id="optionsPanel" class="panel" role="dialog" aria-modal="false" style="position:fixed;left:16px;bottom:72px;z-index:9999;display:none;min-width:220px;">
        <h3 style="margin:0 0 8px 0;font-size:0.95rem;">Display options</h3>
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
            <input type="checkbox" id="optScrollSnap"> Enable scroll snap
        </label>
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
            <input type="checkbox" id="optAnimations"> Section animations
        </label>
        <!-- Pin Highlights option removed -->
    </div>
    <a class="skip-link" href="#main-content">Skip to content</a>
    <!-- high contrast is now enabled by default -->
    <div class="page-container">
        <!-- top-tabs removed per user request -->
    <nav class="left-nav panel" role="tablist" aria-label="Main sections">
            <button type="button" role="tab" data-target="about" class="active" aria-current="true" aria-selected="true" aria-controls="about">About Me</button>
            <button type="button" role="tab" data-target="education" aria-selected="false" aria-controls="education">Education</button>
            <button type="button" role="tab" data-target="experience" aria-selected="false" aria-controls="experience">Experience</button>
            <button type="button" role="tab" data-target="skills" aria-selected="false" aria-controls="skills">Skills & Interests</button>
            <button type="button" role="tab" data-target="projects" aria-selected="false" aria-controls="projects">Projects</button>
            <button type="button" role="tab" data-target="fun" aria-selected="false" aria-controls="fun">Fun Facts</button>
        </nav>

    <div class="header panel" role="banner">
            <img src="https://via.placeholder.com/200x200/3498db/ffffff?text=Your+Photo" alt="Ergash Ruzehaji" class="profile-photo">
            <div>
                <h1>Ergash Ruzehaji</h1>
                <p class="subtitle">Assistant</p>
            </div>
        </div>
    <main class="content-area" id="main-content" role="main">
            <div class="content-inner">
            <div id="about" class="tab-content panel" role="tabpanel" aria-hidden="false">
                <div class="section" id="section-about">
                    <div class="section-head">
                        <h2>About Me</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-about-content">Hide</button>
                    </div>
                    <div id="section-about-content" class="section-body">
                    <p>I am an Asian American who tries to learn something new everyday, regardless of use. I try my best to be as independent as possible but then realize that I am only human. I do ask for assistance when I have reached my limit(s).</p>
                    <p>I am into exercising, reading, and exploring anything on land, air or sea.</p>
                    </div>
                </div>
            </div>
            </div>
            <div id="education" class="tab-content panel" role="tabpanel" aria-hidden="true">
                <div class="section" id="section-education">
                    <div class="section-head">
                        <h2>Education</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-education-content">Hide</button>
                    </div>
                    <div id="section-education-content" class="section-body">
                        <p>Academic background and certifications.</p>
                    </div>
                </div>
            </div>
            <div id="experience" class="tab-content panel" role="tabpanel" aria-hidden="true">
                <div class="section" id="section-experience">
                    <div class="section-head">
                        <h2>Experience</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-experience-content">Hide</button>
                    </div>
                    <div id="section-experience-content" class="section-body">
                        <p>Professional experience managing properties and tenant relations.</p>
                    </div>
                </div>
            </div>
            <div id="skills" class="tab-content panel" role="tabpanel" aria-hidden="true">
                <div class="section" id="section-skills">
                    <div class="section-head">
                        <h2>Skills & Interests</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-skills-content">Hide</button>
                    </div>
                    <div id="section-skills-content" class="section-body">
                        <p>Hands-on skills and personal interests.</p>
                    </div>
                </div>
            </div>
            <div id="fun" class="tab-content panel" role="tabpanel" aria-hidden="true">
                <div class="section" id="section-fun">
                    <div class="section-head">
                        <h2>Fun Facts</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-fun-content">Hide</button>
                    </div>
                    <div id="section-fun-content" class="section-body">
                        <p>Little-known facts and personal tidbits.</p>
                    </div>
                </div>
            </div>

            <div id="projects" class="tab-content panel" role="tabpanel" aria-hidden="true">
                <div class="section" id="section-projects">
                    <div class="section-head">
                        <h2>Projects</h2>
                        <button type="button" class="section-toggle" aria-expanded="true" aria-controls="section-projects-content">Hide</button>
                    </div>
                    <div id="section-projects-content" class="section-body">
                        <p>Selected projects and portfolio items.</p>
                    </div>
                </div>
            </div>

            <!-- move bullet column here so it centers under main content -->
            <!-- Highlights removed (right-side content removed per user's request) -->

            <div class="contact-info panel" style="grid-column:2;grid-row:3;">
            <h2>Get In Touch</h2>
            <p>
                <a href="mailto:ergash.ruzehaji@pursuit.com">Email</a> |
                <a href="https://linkedin.com/in/yourprofile" target="_blank" rel="noopener noreferrer">LinkedIn</a> |
                <a href="https://github.com/ergashruzehaji" target="_blank" rel="noopener noreferrer">GitHub</a> |
                <a href="tel:+1234567890">Phone</a>
            </p>
        </div>
    </div>
    <script>
    // Accessibility: live announcer for screen readers and simple announcements for children
    (function() {
        let announcer = document.getElementById('a11y-announcer');
        if (!announcer) {
            announcer = document.createElement('div');
            announcer.id = 'a11y-announcer';
            announcer.className = 'visually-hidden';
            announcer.setAttribute('aria-live', 'polite');
            announcer.setAttribute('aria-atomic', 'true');
            document.body.appendChild(announcer);
        }

        const speak = (text) => {
            try { announcer.textContent = text; } catch (e) { /* ignore */ }
        };

        // Announce when sections are activated via activateSection
        const originalActivate = window.activateSection;
        // If activateSection is defined later, we'll patch via events. Use DOM events instead.
        document.addEventListener('section-activated', (e) => {
            const id = e.detail && e.detail.id;
            const titleEl = id ? document.querySelector('#' + id + ' h2') : null;
            const title = titleEl ? titleEl.textContent : (id || 'section');
            speak(title + ' section opened');
        });

        // Announce when a section is collapsed/expanded
        document.addEventListener('section-toggle', (e) => {
            const id = e.detail && e.detail.id;
            const state = e.detail && e.detail.state; // 'collapsed' or 'expanded'
            const titleEl = id ? document.querySelector('#' + id + ' h2') : null;
            const title = titleEl ? titleEl.textContent : (id || 'section');
            speak(title + ' ' + (state === 'collapsed' ? 'hidden' : 'shown'));
        });
    })();

    // Scrollspy + smooth scroll for navigation (left nav + top tabs)
    (function() {
    const nav = document.querySelector('.left-nav');
    const topTabsContainer = document.querySelector('.top-tabs');
    if (!nav) return;

    const buttons = Array.from(nav.querySelectorAll('button[data-target]'));
    const topTabs = topTabsContainer ? Array.from(topTabsContainer.querySelectorAll('button[data-target]')) : [];
        const sections = buttons.map(b => document.getElementById(b.dataset.target)).filter(Boolean);

        // Centralized activation so left-nav, top-tabs, and bullets stay in sync (ARIA-aware)
        const activateSection = (id, { source = 'manual' } = {}) => {
            const el = document.getElementById(id);
            if (!el) return;

            // Show only the active tab content (embedded in page) and update aria-hidden
            document.querySelectorAll('.tab-content').forEach(tc => {
                const isActive = tc.id === id;
                tc.classList.toggle('active', isActive);
                tc.setAttribute('aria-hidden', isActive ? 'false' : 'true');
            });

            // update left nav (tabs)
            buttons.forEach(b => {
                const selected = b.dataset.target === id;
                b.classList.toggle('active', selected);
                b.toggleAttribute('aria-current', selected);
                b.setAttribute('aria-selected', selected ? 'true' : 'false');
                b.setAttribute('tabindex', selected ? '0' : '-1');
            });

            // update top tabs (if present)
            topTabs.forEach(t => {
                const sel = t.dataset.target === id;
                t.classList.toggle('active', sel);
                t.setAttribute('aria-selected', sel ? 'true' : 'false');
            });

            // update bullets: highlight the matching card
            document.querySelectorAll('.bullet-card').forEach(c => c.classList.remove('active'));
            const card = document.getElementById('bullet-' + id);
            if (card) card.classList.add('active');

            // Dispatch a DOM event so screen readers / announcer can react
            try {
                const ev = new CustomEvent('section-activated', { detail: { id } });
                document.dispatchEvent(ev);
            } catch (e) { /* ignore */ }
        };

        // Wire left-nav buttons (ARIA tab behavior)
        buttons.forEach((btn, idx) => {
            // ensure proper tabindex
            btn.setAttribute('tabindex', btn.classList.contains('active') ? '0' : '-1');

            btn.addEventListener('click', (e) => { e.preventDefault(); activateSection(btn.dataset.target, { source: 'nav' }); btn.focus(); });
            btn.addEventListener('keydown', (e) => {
                const key = e.key;
                if (key === 'Enter' || key === ' ') { e.preventDefault(); activateSection(btn.dataset.target, { source: 'nav' }); }
                else if (key === 'ArrowDown') { e.preventDefault(); (buttons[idx + 1] || buttons[0]).focus(); }
                else if (key === 'ArrowUp') { e.preventDefault(); (buttons[idx - 1] || buttons[buttons.length - 1]).focus(); }
                else if (key === 'Home') { e.preventDefault(); buttons[0].focus(); }
                else if (key === 'End') { e.preventDefault(); buttons[buttons.length - 1].focus(); }
            });
        });

        // Initialize default active section
        window.addEventListener('DOMContentLoaded', () => {
            const initial = buttons.find(b => b.classList.contains('active')) || buttons[0];
            if (initial) activateSection(initial.dataset.target, { source: 'init' });
        });

        // Wire top-tabs buttons (mouse + keyboard) - if top tabs are present
        topTabs.forEach((t, idx) => {
            t.addEventListener('click', (e) => { e.preventDefault(); activateSection(t.dataset.target, { source: 'top' }); t.focus(); });
            t.addEventListener('keydown', (e) => {
                const key = e.key;
                if (key === 'Enter' || key === ' ') { e.preventDefault(); activateSection(t.dataset.target, { source: 'top' }); }
                else if (key === 'ArrowRight') { e.preventDefault(); (topTabs[idx + 1] || topTabs[0]).focus(); }
                else if (key === 'ArrowLeft') { e.preventDefault(); (topTabs[idx - 1] || topTabs[topTabs.length - 1]).focus(); }
                else if (key === 'Home') { e.preventDefault(); topTabs[0].focus(); }
                else if (key === 'End') { e.preventDefault(); topTabs[topTabs.length - 1].focus(); }
            });
        });

    // No intersection-based auto-activation: activation happens only via nav clicks
    })();

    // High contrast is permanent by default (no toggle)

    // Bullets panels: reveal on scroll and allow collapse on small screens
    (function() {
        const panels = Array.from(document.querySelectorAll('.bullets-panel'));
        if (!panels.length) return;

        // IntersectionObserver to add reveal class
        const revObs = new IntersectionObserver((entries) => {
            entries.forEach(en => {
                if (en.isIntersecting) en.target.classList.add('reveal');
            });
        }, { threshold: 0.12 });
        panels.forEach(p => revObs.observe(p));

        // Toggle behavior for small screens
        panels.forEach(panel => {
            const toggle = panel.querySelector('.bullets-toggle');
            if (!toggle) return;
            toggle.addEventListener('click', () => {
                const expanded = toggle.getAttribute('aria-expanded') === 'true';
                toggle.setAttribute('aria-expanded', String(!expanded));
                panel.classList.toggle('collapsed', expanded);
            });
        });
    })();

    // Section collapse/expand with persistence
    (function() {
        const keyPrefix = 'sectionCollapsed:';
        const toggles = Array.from(document.querySelectorAll('.section-toggle'));
        toggles.forEach(btn => {
            const targetId = btn.getAttribute('aria-controls');
            const sectionBody = document.getElementById(targetId);
            if (!sectionBody) return;
            const section = sectionBody.closest('.section');
            if (!section) return;

            const id = section.id || targetId;
            const stored = localStorage.getItem(keyPrefix + id);
            const isCollapsed = stored === '1';
            if (isCollapsed) {
                section.classList.add('collapsed');
                btn.setAttribute('aria-expanded', 'false');
                btn.textContent = 'Show';
            }

            btn.addEventListener('click', () => {
                const collapsed = section.classList.toggle('collapsed');
                btn.setAttribute('aria-expanded', collapsed ? 'false' : 'true');
                btn.textContent = collapsed ? 'Show' : 'Hide';
                try { localStorage.setItem(keyPrefix + id, collapsed ? '1' : '0'); } catch (e) {}
                // Announce collapse/expand for assistive tech and children
                try {
                    const ev = new CustomEvent('section-toggle', { detail: { id: section.id || id, state: collapsed ? 'collapsed' : 'expanded' } });
                    document.dispatchEvent(ev);
                } catch (e) { /* ignore */ }
            });
        });
    })();

    // Options panel behavior: toggles for scroll-snap and section animations
    (function() {
        const btn = document.getElementById('optionsToggle');
        const panel = document.getElementById('optionsPanel');
    const optSnap = document.getElementById('optScrollSnap');
    const optAnim = document.getElementById('optAnimations');

        if (!btn || !panel) return;

        const prefsKey = 'siteOptionsV1';
        const applyPrefs = (prefs) => {
            document.body.classList.toggle('scroll-snap', !!prefs.scrollSnap);
            document.body.classList.toggle('animations', !!prefs.animations);
            if (optSnap) optSnap.checked = !!prefs.scrollSnap;
            if (optAnim) optAnim.checked = !!prefs.animations;
        };

        // Load stored prefs
        try {
            const raw = localStorage.getItem(prefsKey);
            const parsed = raw ? JSON.parse(raw) : {};
            applyPrefs(parsed);
        } catch (e) { /* ignore */ }

        // Toggle panel visibility
        btn.addEventListener('click', () => {
            const showing = panel.style.display === 'block';
            panel.style.display = showing ? 'none' : 'block';
            btn.setAttribute('aria-pressed', String(!showing));
        });

        // Focus management: focus first input when panel opens
        panel.addEventListener('transitionend', () => { const first = panel.querySelector('input,button'); if (first) first.focus(); });

        const saveAndApply = () => {
            const prefs = { scrollSnap: !!optSnap.checked, animations: !!optAnim.checked };
            try { localStorage.setItem(prefsKey, JSON.stringify(prefs)); } catch (e) {}
            applyPrefs(prefs);
        };

        [optSnap, optAnim].forEach(el => { if (!el) return; el.addEventListener('change', saveAndApply); });

        // If animations are enabled, reveal each tab-content when it becomes intersecting
        const animObserver = new IntersectionObserver((entries) => {
            entries.forEach(en => {
                const tc = en.target;
                if (en.isIntersecting && document.body.classList.contains('animations')) {
                    tc.classList.add('revealed');
                } else {
                    tc.classList.remove('revealed');
                }
            });
        }, { threshold: 0.45 });

        document.querySelectorAll('.tab-content').forEach(tc => animObserver.observe(tc));
        
        // Close options panel with Escape
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (panel.style.display === 'block') { panel.style.display = 'none'; btn.setAttribute('aria-pressed', 'false'); }
            }
        });
    })();
    </script>
</body>
</html>